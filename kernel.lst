     1                                  %include "pm.mac"
     2                              <1> 
     3                              <1> ; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     4                              <1> ;                               pm.inc
     5                              <1> ; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     6                              <1> ;                                                     Forrest Yu, 2005
     7                              <1> ; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     8                              <1> 
     9                              <1> 
    10                              <1> ; æè¿°ç¬¦å›¾ç¤º
    11                              <1> 
    12                              <1> ; å›¾ç¤ºä¸€
    13                              <1> ;
    14                              <1> ;  ------ â”â”â”â”³â”â”â”“é«˜åœ°å€
    15                              <1> ;         â”ƒ 7  â”ƒ æ®µ â”ƒ
    16                              <1> ;         â”£â”â”â”«    â”ƒ
    17                              <1> ;                  åŸº
    18                              <1> ;  å­—èŠ‚ 7 â”†    â”†    â”†
    19                              <1> ;                  å€
    20                              <1> ;         â”£â”â”â”« â‘¡ â”ƒ
    21                              <1> ;         â”ƒ 0  â”ƒ    â”ƒ
    22                              <1> ;  ------ â”£â”â”â•‹â”â”â”«
    23                              <1> ;         â”ƒ 7  â”ƒ G  â”ƒ
    24                              <1> ;         â”£â”â”â•‰â”€â”€â”¨
    25                              <1> ;         â”ƒ 6  â”ƒ D  â”ƒ
    26                              <1> ;         â”£â”â”â•‰â”€â”€â”¨
    27                              <1> ;         â”ƒ 5  â”ƒ 0  â”ƒ
    28                              <1> ;         â”£â”â”â•‰â”€â”€â”¨
    29                              <1> ;         â”ƒ 4  â”ƒ AVLâ”ƒ
    30                              <1> ;  å­—èŠ‚ 6 â”£â”â”â•‰â”€â”€â”¨
    31                              <1> ;         â”ƒ 3  â”ƒ    â”ƒ
    32                              <1> ;         â”£â”â”â”« æ®µ â”ƒ
    33                              <1> ;         â”ƒ 2  â”ƒ ç•Œ â”ƒ
    34                              <1> ;         â”£â”â”â”« é™ â”ƒ
    35                              <1> ;         â”ƒ 1  â”ƒ    â”ƒ
    36                              <1> ;         â”£â”â”â”« â‘¡ â”ƒ
    37                              <1> ;         â”ƒ 0  â”ƒ    â”ƒ
    38                              <1> ;  ------ â”£â”â”â•‹â”â”â”«
    39                              <1> ;         â”ƒ 7  â”ƒ P  â”ƒ
    40                              <1> ;         â”£â”â”â•‰â”€â”€â”¨
    41                              <1> ;         â”ƒ 6  â”ƒ    â”ƒ
    42                              <1> ;         â”£â”â”â”« DPLâ”ƒ
    43                              <1> ;         â”ƒ 5  â”ƒ    â”ƒ
    44                              <1> ;         â”£â”â”â•‰â”€â”€â”¨
    45                              <1> ;         â”ƒ 4  â”ƒ S  â”ƒ
    46                              <1> ;  å­—èŠ‚ 5 â”£â”â”â•‰â”€â”€â”¨
    47                              <1> ;         â”ƒ 3  â”ƒ    â”ƒ
    48                              <1> ;         â”£â”â”â”« T  â”ƒ
    49                              <1> ;         â”ƒ 2  â”ƒ Y  â”ƒ
    50                              <1> ;         â”£â”â”â”« P  â”ƒ
    51                              <1> ;         â”ƒ 1  â”ƒ E  â”ƒ
    52                              <1> ;         â”£â”â”â”«    â”ƒ
    53                              <1> ;         â”ƒ 0  â”ƒ    â”ƒ
    54                              <1> ;  ------ â”£â”â”â•‹â”â”â”«
    55                              <1> ;         â”ƒ 23 â”ƒ    â”ƒ
    56                              <1> ;         â”£â”â”â”«    â”ƒ
    57                              <1> ;         â”ƒ 22 â”ƒ    â”ƒ
    58                              <1> ;         â”£â”â”â”« æ®µ â”ƒ
    59                              <1> ;
    60                              <1> ;   å­—èŠ‚  â”†    â”† åŸº â”†
    61                              <1> ; 2, 3, 4
    62                              <1> ;         â”£â”â”â”« å€ â”ƒ
    63                              <1> ;         â”ƒ 1  â”ƒ â‘  â”ƒ
    64                              <1> ;         â”£â”â”â”«    â”ƒ
    65                              <1> ;         â”ƒ 0  â”ƒ    â”ƒ
    66                              <1> ;  ------ â”£â”â”â•‹â”â”â”«
    67                              <1> ;         â”ƒ 15 â”ƒ    â”ƒ
    68                              <1> ;         â”£â”â”â”«    â”ƒ
    69                              <1> ;         â”ƒ 14 â”ƒ    â”ƒ
    70                              <1> ;         â”£â”â”â”« æ®µ â”ƒ
    71                              <1> ;
    72                              <1> ; å­—èŠ‚ 0,1â”†    â”† ç•Œ â”†
    73                              <1> ;
    74                              <1> ;         â”£â”â”â”« é™ â”ƒ
    75                              <1> ;         â”ƒ 1  â”ƒ â‘  â”ƒ
    76                              <1> ;         â”£â”â”â”«    â”ƒ
    77                              <1> ;         â”ƒ 0  â”ƒ    â”ƒ
    78                              <1> ;  ------ â”—â”â”â”»â”â”â”›ä½åœ°å€
    79                              <1> ;
    80                              <1> 
    81                              <1> 
    82                              <1> ; å›¾ç¤ºäºŒ
    83                              <1> 
    84                              <1> ; é«˜åœ°å€â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ä½åœ°å€
    85                              <1> 
    86                              <1> ; |   7   |   6   |   5   |   4   |   3   |   2   |   1   |   0    |
    87                              <1> ; |7654321076543210765432107654321076543210765432107654321076543210|	<- å…± 8 å­—èŠ‚
    88                              <1> ; |--------========--------========--------========--------========|
    89                              <1> ; â”â”â”â”â”³â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”“
    90                              <1> ; â”ƒ31..24â”ƒ   (è§ä¸‹å›¾)   â”ƒ     æ®µåŸºå€(23..0)    â”ƒ æ®µç•Œé™(15..0)â”ƒ
    91                              <1> ; â”ƒ      â”ƒ              â”ƒ                      â”ƒ              â”ƒ
    92                              <1> ; â”ƒ åŸºå€2â”ƒâ‘¢â”‚â‘¡â”‚    â‘ â”ƒåŸºå€1bâ”‚   åŸºå€1a     â”ƒ    æ®µç•Œé™1   â”ƒ
    93                              <1> ; â”£â”â”â”â•‹â”â”â”â”³â”â”â”â•‹â”â”â”â”â”â”â”â”â”â”â”â•‹â”â”â”â”â”â”â”â”«
    94                              <1> ; â”ƒ   %6 â”ƒ  %5  â”ƒ  %4  â”ƒ  %3  â”ƒ     %2       â”ƒ       %1     â”ƒ
    95                              <1> ; â”—â”â”â”â”»â”â”â”â”»â”â”â”â”»â”â”â”â”»â”â”â”â”â”â”â”â”»â”â”â”â”â”â”â”â”›
    96                              <1> ;         â”‚                \_________
    97                              <1> ;         â”‚                          \__________________
    98                              <1> ;         â”‚                                             \________________________________________________
    99                              <1> ;         â”‚                                                                                              ;         â”â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”
   100                              <1> ;         â”ƒ 7  â”ƒ 6  â”ƒ 5  â”ƒ 4  â”ƒ 3  â”ƒ 2  â”ƒ 1  â”ƒ 0  â”ƒ 7  â”ƒ 6  â”ƒ 5  â”ƒ 4  â”ƒ 3  â”ƒ 2  â”ƒ 1  â”ƒ 0  â”ƒ
   101                              <1> ;         â”£â”â”â•‹â”â”â•‹â”â”â•‹â”â”â•‹â”â”â”»â”â”â”»â”â”â”»â”â”â•‹â”â”â•‹â”â”â”»â”â”â•‹â”â”â•‹â”â”â”»â”â”â”»â”â”â”»â”â”â”«
   102                              <1> ;         â”ƒ G  â”ƒ D  â”ƒ 0  â”ƒ AVLâ”ƒ   æ®µç•Œé™ 2 (19..16)  â”ƒ  P â”ƒ   DPL    â”ƒ S  â”ƒ       TYPE           â”ƒ
   103                              <1> ;         â”£â”â”â”»â”â”â”»â”â”â”»â”â”â•‹â”â”â”â”â”â”â”â”â”â”â”â•‹â”â”â”»â”â”â”â”â”â”»â”â”â”»â”â”â”â”â”â”â”â”â”â”â”â”«
   104                              <1> ;         â”ƒ      â‘¢: å±æ€§ 2      â”ƒ    â‘¡: æ®µç•Œé™ 2      â”ƒ                   â‘ : å±æ€§1                  â”ƒ
   105                              <1> ;         â”—â”â”â”â”â”â”â”â”â”â”â”â”»â”â”â”â”â”â”â”â”â”â”â”â”»â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
   106                              <1> ;       é«˜åœ°å€                                                                                          ä½åœ°å€
   107                              <1> ;
   108                              <1> ;
   109                              <1> 
   110                              <1> ; è¯´æ˜:
   111                              <1> ;
   112                              <1> ; (1) P:    å­˜åœ¨(Present)ä½ã€‚
   113                              <1> ;		P=1 è¡¨ç¤ºæè¿°ç¬¦å¯¹åœ°å€è½¬æ¢æ˜¯æœ‰æ•ˆçš„ï¼Œæˆ–è€…è¯´è¯¥æè¿°ç¬¦æ‰€æè¿°çš„æ®µå­˜åœ¨ï¼Œå³åœ¨å†…å­˜ä¸­ï¼›
   114                              <1> ;		P=0 è¡¨ç¤ºæè¿°ç¬¦å¯¹åœ°å€è½¬æ¢æ— æ•ˆï¼Œå³è¯¥æ®µä¸å­˜åœ¨ã€‚ä½¿ç”¨è¯¥æè¿°ç¬¦è¿›è¡Œå†…å­˜è®¿é—®æ—¶ä¼šå¼•èµ·å¼‚å¸¸ã€‚
   115                              <1> ;
   116                              <1> ; (2) DPL:  è¡¨ç¤ºæè¿°ç¬¦ç‰¹æƒçº§(Descriptor Privilege level)ï¼Œå…±2ä½ã€‚å®ƒè§„å®šäº†æ‰€æè¿°æ®µçš„ç‰¹æƒçº§ï¼Œç”¨äºç‰¹æƒæ£€æŸ¥ï¼Œä»¥å†³å®šå¯¹è¯¥æ®µèƒ½å¦è®¿é—®ã€‚ 
   117                              <1> ;
   118                              <1> ; (3) S:   è¯´æ˜æè¿°ç¬¦çš„ç±»å‹ã€‚
   119                              <1> ;		å¯¹äºå­˜å‚¨æ®µæè¿°ç¬¦è€Œè¨€ï¼ŒS=1ï¼Œä»¥åŒºåˆ«ä¸ç³»ç»Ÿæ®µæè¿°ç¬¦å’Œé—¨æè¿°ç¬¦(S=0)ã€‚ 
   120                              <1> ;
   121                              <1> ; (4) TYPE: è¯´æ˜å­˜å‚¨æ®µæè¿°ç¬¦æ‰€æè¿°çš„å­˜å‚¨æ®µçš„å…·ä½“å±æ€§ã€‚
   122                              <1> ;
   123                              <1> ;		 
   124                              <1> ;	æ•°æ®æ®µç±»å‹	ç±»å‹å€¼		è¯´æ˜
   125                              <1> ;			----------------------------------
   126                              <1> ;			0		åªè¯» 
   127                              <1> ;			1		åªè¯»ã€å·²è®¿é—® 
   128                              <1> ;			2		è¯»/å†™ 
   129                              <1> ;			3		è¯»/å†™ã€å·²è®¿é—® 
   130                              <1> ;			4		åªè¯»ã€å‘ä¸‹æ‰©å±• 
   131                              <1> ;			5		åªè¯»ã€å‘ä¸‹æ‰©å±•ã€å·²è®¿é—® 
   132                              <1> ;			6		è¯»/å†™ã€å‘ä¸‹æ‰©å±• 
   133                              <1> ;			7		è¯»/å†™ã€å‘ä¸‹æ‰©å±•ã€å·²è®¿é—® 
   134                              <1> ;
   135                              <1> ;		
   136                              <1> ;			ç±»å‹å€¼		è¯´æ˜
   137                              <1> ;	ä»£ç æ®µç±»å‹	----------------------------------
   138                              <1> ;			8		åªæ‰§è¡Œ 
   139                              <1> ;			9		åªæ‰§è¡Œã€å·²è®¿é—® 
   140                              <1> ;			A		æ‰§è¡Œ/è¯» 
   141                              <1> ;			B		æ‰§è¡Œ/è¯»ã€å·²è®¿é—® 
   142                              <1> ;			C		åªæ‰§è¡Œã€ä¸€è‡´ç æ®µ 
   143                              <1> ;			D		åªæ‰§è¡Œã€ä¸€è‡´ç æ®µã€å·²è®¿é—® 
   144                              <1> ;			E		æ‰§è¡Œ/è¯»ã€ä¸€è‡´ç æ®µ 
   145                              <1> ;			F		æ‰§è¡Œ/è¯»ã€ä¸€è‡´ç æ®µã€å·²è®¿é—® 
   146                              <1> ;
   147                              <1> ;		
   148                              <1> ;	ç³»ç»Ÿæ®µç±»å‹	ç±»å‹ç¼–ç 	è¯´æ˜
   149                              <1> ;			----------------------------------
   150                              <1> ;			0		<æœªå®šä¹‰>
   151                              <1> ;			1		å¯ç”¨286TSS
   152                              <1> ;			2		LDT
   153                              <1> ;			3		å¿™çš„286TSS
   154                              <1> ;			4		286è°ƒç”¨é—¨
   155                              <1> ;			5		ä»»åŠ¡é—¨
   156                              <1> ;			6		286ä¸­æ–­é—¨
   157                              <1> ;			7		286é™·é˜±é—¨
   158                              <1> ;			8		æœªå®šä¹‰
   159                              <1> ;			9		å¯ç”¨386TSS
   160                              <1> ;			A		<æœªå®šä¹‰>
   161                              <1> ;			B		å¿™çš„386TSS
   162                              <1> ;			C		386è°ƒç”¨é—¨
   163                              <1> ;			D		<æœªå®šä¹‰>
   164                              <1> ;			E		386ä¸­æ–­é—¨
   165                              <1> ;			F		386é™·é˜±é—¨
   166                              <1> ;
   167                              <1> ; (5) G:    æ®µç•Œé™ç²’åº¦(Granularity)ä½ã€‚
   168                              <1> ;		G=0 è¡¨ç¤ºç•Œé™ç²’åº¦ä¸ºå­—èŠ‚ï¼›
   169                              <1> ;		G=1 è¡¨ç¤ºç•Œé™ç²’åº¦ä¸º4K å­—èŠ‚ã€‚
   170                              <1> ;           æ³¨æ„ï¼Œç•Œé™ç²’åº¦åªå¯¹æ®µç•Œé™æœ‰æ•ˆï¼Œå¯¹æ®µåŸºåœ°å€æ— æ•ˆï¼Œæ®µåŸºåœ°å€æ€»æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½ã€‚ 
   171                              <1> ;
   172                              <1> ; (6) D:    Dä½æ˜¯ä¸€ä¸ªå¾ˆç‰¹æ®Šçš„ä½ï¼Œåœ¨æè¿°å¯æ‰§è¡Œæ®µã€å‘ä¸‹æ‰©å±•æ•°æ®æ®µæˆ–ç”±SSå¯„å­˜å™¨å¯»å€çš„æ®µ(é€šå¸¸æ˜¯å †æ ˆæ®µ)çš„ä¸‰ç§æè¿°ç¬¦ä¸­çš„æ„ä¹‰å„ä¸ç›¸åŒã€‚ 
   173                              <1> ;           â‘´ åœ¨æè¿°å¯æ‰§è¡Œæ®µçš„æè¿°ç¬¦ä¸­ï¼ŒDä½å†³å®šäº†æŒ‡ä»¤ä½¿ç”¨çš„åœ°å€åŠæ“ä½œæ•°æ‰€é»˜è®¤çš„å¤§å°ã€‚
   174                              <1> ;		â‘  D=1è¡¨ç¤ºé»˜è®¤æƒ…å†µä¸‹æŒ‡ä»¤ä½¿ç”¨32ä½åœ°å€åŠ32ä½æˆ–8ä½æ“ä½œæ•°ï¼Œè¿™æ ·çš„ä»£ç æ®µä¹Ÿç§°ä¸º32ä½ä»£ç æ®µï¼›
   175                              <1> ;		â‘¡ D=0 è¡¨ç¤ºé»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨16ä½åœ°å€åŠ16ä½æˆ–8ä½æ“ä½œæ•°ï¼Œè¿™æ ·çš„ä»£ç æ®µä¹Ÿç§°ä¸º16ä½ä»£ç æ®µï¼Œå®ƒä¸80286å…¼å®¹ã€‚å¯ä»¥ä½¿ç”¨åœ°å€å¤§å°å‰ç¼€å’Œæ“ä½œæ•°å¤§å°å‰ç¼€åˆ†åˆ«æ”¹å˜é»˜è®¤
   176                              <1> ;           â‘µ åœ¨å‘ä¸‹æ‰©å±•æ•°æ®æ®µçš„æè¿°ç¬¦ä¸­ï¼ŒDä½å†³å®šæ®µçš„ä¸Šéƒ¨è¾¹ç•Œã€‚
   177                              <1> ;		â‘  D=1è¡¨ç¤ºæ®µçš„ä¸Šéƒ¨ç•Œé™ä¸º4Gï¼›
   178                              <1> ;		â‘¡ D=0è¡¨ç¤ºæ®µçš„ä¸Šéƒ¨ç•Œé™ä¸º64Kï¼Œè¿™æ˜¯ä¸ºäº†ä¸80286å…¼å®¹ã€‚ 
   179                              <1> ;           â‘¶ åœ¨æè¿°ç”±SSå¯„å­˜å™¨å¯»å€çš„æ®µæè¿°ç¬¦ä¸­ï¼ŒDä½å†³å®šéšå¼çš„å †æ ˆè®¿é—®æŒ‡ä»¤(å¦‚PUSHå’ŒPOPæŒ‡ä»¤)ä½¿ç”¨ä½•ç§å †æ ˆæŒ‡é’ˆå¯„å­˜å™¨ã€‚
   180                              <1> ;		â‘  D=1è¡¨ç¤ºä½¿ç”¨32ä½å †æ ˆæŒ‡é’ˆå¯„å­˜å™¨ESPï¼›
   181                              <1> ;		â‘¡ D=0è¡¨ç¤ºä½¿ç”¨16ä½å †æ ˆæŒ‡é’ˆå¯„å­˜å™¨SPï¼Œè¿™ä¸80286å…¼å®¹ã€‚ 
   182                              <1> ;
   183                              <1> ; (7) AVL:  è½¯ä»¶å¯åˆ©ç”¨ä½ã€‚80386å¯¹è¯¥ä½çš„ä½¿ç”¨æœªå·¦è§„å®šï¼ŒIntelå…¬å¸ä¹Ÿä¿è¯ä»Šåå¼€å‘ç”Ÿäº§çš„å¤„ç†å™¨åªè¦ä¸80386å…¼å®¹ï¼Œå°±ä¸ä¼šå¯¹è¯¥ä½çš„ä½¿ç”¨åšä»»ä½•å®šä¹‰æˆ–è§„å®šã€‚ 
   184                              <1> ;
   185                              <1> 
   186                              <1> 
   187                              <1> ;----------------------------------------------------------------------------
   188                              <1> ; æè¿°ç¬¦ç±»å‹å€¼è¯´æ˜
   189                              <1> ; å…¶ä¸­:
   190                              <1> ;       DA_  : Descriptor Attribute
   191                              <1> ;       D    : æ•°æ®æ®µ
   192                              <1> ;       C    : ä»£ç æ®µ
   193                              <1> ;       S    : ç³»ç»Ÿæ®µ
   194                              <1> ;       R    : åªè¯»
   195                              <1> ;       RW   : è¯»å†™
   196                              <1> ;       A    : å·²è®¿é—®
   197                              <1> ;       å…¶å®ƒ : å¯æŒ‰ç…§å­—é¢æ„æ€ç†è§£
   198                              <1> ;----------------------------------------------------------------------------
   199                              <1> DA_32		EQU	4000h	; 32 ä½æ®µ
   200                              <1> DA_LIMIT_4K	EQU	8000h	; æ®µç•Œé™ç²’åº¦ä¸º 4K å­—èŠ‚
   201                              <1> 
   202                              <1> DA_DPL0		EQU	  00h	; DPL = 0
   203                              <1> DA_DPL1		EQU	  20h	; DPL = 1
   204                              <1> DA_DPL2		EQU	  40h	; DPL = 2
   205                              <1> DA_DPL3		EQU	  60h	; DPL = 3
   206                              <1> ;----------------------------------------------------------------------------
   207                              <1> ; å­˜å‚¨æ®µæè¿°ç¬¦ç±»å‹å€¼è¯´æ˜
   208                              <1> ;----------------------------------------------------------------------------
   209                              <1> DA_DR		EQU	90h	; å­˜åœ¨çš„åªè¯»æ•°æ®æ®µç±»å‹å€¼
   210                              <1> DA_DRW		EQU	92h	; å­˜åœ¨çš„å¯è¯»å†™æ•°æ®æ®µå±æ€§å€¼
   211                              <1> DA_DRWA		EQU	93h	; å­˜åœ¨çš„å·²è®¿é—®å¯è¯»å†™æ•°æ®æ®µç±»å‹å€¼
   212                              <1> DA_C		EQU	98h	; å­˜åœ¨çš„åªæ‰§è¡Œä»£ç æ®µå±æ€§å€¼
   213                              <1> DA_CR		EQU	9Ah	; å­˜åœ¨çš„å¯æ‰§è¡Œå¯è¯»ä»£ç æ®µå±æ€§å€¼
   214                              <1> DA_CCO		EQU	9Ch	; å­˜åœ¨çš„åªæ‰§è¡Œä¸€è‡´ä»£ç æ®µå±æ€§å€¼
   215                              <1> DA_CCOR		EQU	9Eh	; å­˜åœ¨çš„å¯æ‰§è¡Œå¯è¯»ä¸€è‡´ä»£ç æ®µå±æ€§å€¼
   216                              <1> ;----------------------------------------------------------------------------
   217                              <1> ; ç³»ç»Ÿæ®µæè¿°ç¬¦ç±»å‹å€¼è¯´æ˜
   218                              <1> ;----------------------------------------------------------------------------
   219                              <1> DA_LDT		EQU	  82h	; å±€éƒ¨æè¿°ç¬¦è¡¨æ®µç±»å‹å€¼
   220                              <1> DA_TaskGate	EQU	  85h	; ä»»åŠ¡é—¨ç±»å‹å€¼
   221                              <1> DA_386TSS	EQU	  89h	; å¯ç”¨ 386 ä»»åŠ¡çŠ¶æ€æ®µç±»å‹å€¼
   222                              <1> DA_386CGate	EQU	  8Ch	; 386 è°ƒç”¨é—¨ç±»å‹å€¼
   223                              <1> DA_386IGate	EQU	  8Eh	; 386 ä¸­æ–­é—¨ç±»å‹å€¼
   224                              <1> DA_386TGate	EQU	  8Fh	; 386 é™·é˜±é—¨ç±»å‹å€¼
   225                              <1> ;----------------------------------------------------------------------------
   226                              <1> 
   227                              <1> 
   228                              <1> ; é€‰æ‹©å­å›¾ç¤º:
   229                              <1> ;         â”â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”³â”â”â”“
   230                              <1> ;         â”ƒ 15 â”ƒ 14 â”ƒ 13 â”ƒ 12 â”ƒ 11 â”ƒ 10 â”ƒ 9  â”ƒ 8  â”ƒ 7  â”ƒ 6  â”ƒ 5  â”ƒ 4  â”ƒ 3  â”ƒ 2  â”ƒ 1  â”ƒ 0  â”ƒ
   231                              <1> ;         â”£â”â”â”»â”â”â”»â”â”â”»â”â”â”»â”â”â”»â”â”â”»â”â”â”»â”â”â”»â”â”â”»â”â”â”»â”â”â”»â”â”â”»â”â”â•‹â”â”â•‹â”â”â”»â”â”â”«
   232                              <1> ;         â”ƒ                                 æè¿°ç¬¦ç´¢å¼•                                 â”ƒ TI â”ƒ   RPL    â”ƒ
   233                              <1> ;         â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”»â”â”â”»â”â”â”â”â”â”›
   234                              <1> ;
   235                              <1> ; RPL(Requested Privilege Level): è¯·æ±‚ç‰¹æƒçº§ï¼Œç”¨äºç‰¹æƒæ£€æŸ¥ã€‚
   236                              <1> ;
   237                              <1> ; TI(Table Indicator): å¼•ç”¨æè¿°ç¬¦è¡¨æŒ‡ç¤ºä½
   238                              <1> ;	TI=0 æŒ‡ç¤ºä»å…¨å±€æè¿°ç¬¦è¡¨GDTä¸­è¯»å–æè¿°ç¬¦ï¼›
   239                              <1> ;	TI=1 æŒ‡ç¤ºä»å±€éƒ¨æè¿°ç¬¦è¡¨LDTä¸­è¯»å–æè¿°ç¬¦ã€‚
   240                              <1> ;
   241                              <1> 
   242                              <1> ;----------------------------------------------------------------------------
   243                              <1> ; é€‰æ‹©å­ç±»å‹å€¼è¯´æ˜
   244                              <1> ; å…¶ä¸­:
   245                              <1> ;       SA_  : Selector Attribute
   246                              <1> 
   247                              <1> SA_RPL0		EQU	0	; â”“
   248                              <1> SA_RPL1		EQU	1	; â”£ RPL
   249                              <1> SA_RPL2		EQU	2	; â”ƒ
   250                              <1> SA_RPL3		EQU	3	; â”›
   251                              <1> 
   252                              <1> SA_TIG		EQU	0	; â”“TI
   253                              <1> SA_TIL		EQU	4	; â”›
   254                              <1> ;----------------------------------------------------------------------------
   255                              <1> 
   256                              <1> 
   257                              <1> ;----------------------------------------------------------------------------
   258                              <1> ; åˆ†é¡µæœºåˆ¶ä½¿ç”¨çš„å¸¸é‡è¯´æ˜
   259                              <1> ;----------------------------------------------------------------------------
   260                              <1> PG_P		EQU	1	; é¡µå­˜åœ¨å±æ€§ä½
   261                              <1> PG_RWR		EQU	0	; R/W å±æ€§ä½å€¼, è¯»/æ‰§è¡Œ
   262                              <1> PG_RWW		EQU	2	; R/W å±æ€§ä½å€¼, è¯»/å†™/æ‰§è¡Œ
   263                              <1> PG_USS		EQU	0	; U/S å±æ€§ä½å€¼, ç³»ç»Ÿçº§
   264                              <1> PG_USU		EQU	4	; U/S å±æ€§ä½å€¼, ç”¨æˆ·çº§
   265                              <1> ;----------------------------------------------------------------------------
   266                              <1> 
   267                              <1> 
   268                              <1> 
   269                              <1> 
   270                              <1> ; =========================================
   271                              <1> ; FLAGS - Intel 8086 Family Flags Register
   272                              <1> ; =========================================
   273                              <1> ;
   274                              <1> ;      |11|10|F|E|D|C|B|A|9|8|7|6|5|4|3|2|1|0|
   275                              <1> ;        |  | | | | | | | | | | | | | | | | '---  CFâ€¦â€¦Carry Flag
   276                              <1> ;        |  | | | | | | | | | | | | | | | '---  1
   277                              <1> ;        |  | | | | | | | | | | | | | | '---  PFâ€¦â€¦Parity Flag
   278                              <1> ;        |  | | | | | | | | | | | | | '---  0
   279                              <1> ;        |  | | | | | | | | | | | | '---  AFâ€¦â€¦Auxiliary Flag
   280                              <1> ;        |  | | | | | | | | | | | '---  0
   281                              <1> ;        |  | | | | | | | | | | '---  ZFâ€¦â€¦Zero Flag
   282                              <1> ;        |  | | | | | | | | | '---  SFâ€¦â€¦Sign Flag
   283                              <1> ;        |  | | | | | | | | '---  TFâ€¦â€¦Trap Flag  (Single Step)
   284                              <1> ;        |  | | | | | | | '---  IFâ€¦â€¦Interrupt Flag
   285                              <1> ;        |  | | | | | | '---  DFâ€¦â€¦Direction Flag
   286                              <1> ;        |  | | | | | '---  OFâ€¦â€¦Overflow flag
   287                              <1> ;        |  | | | '-----  IOPLâ€¦â€¦I/O Privilege Level  (286+ only)
   288                              <1> ;        |  | | '-----  NTâ€¦â€¦Nested Task Flag  (286+ only)
   289                              <1> ;        |  | '-----  0
   290                              <1> ;        |  '-----  RFâ€¦â€¦Resume Flag (386+ only)
   291                              <1> ;        '------  VMâ€¦â€¦Virtual Mode Flag (386+ only)
   292                              <1> ;
   293                              <1> ;        æ³¨: see   PUSHF  POPF  STI  CLI  STD  CLD
   294                              <1> ;
   295                              <1> 
   296                              <1> 
   297                              <1> ; å® ------------------------------------------------------------------------------------------------------
   298                              <1> ;
   299                              <1> ; æè¿°ç¬¦
   300                              <1> ; usage: Descriptor Base, Limit, Attr
   301                              <1> ;        Base:  dd
   302                              <1> ;        Limit: dd (low 20 bits available)
   303                              <1> ;        Attr:  dw (lower 4 bits of higher byte are always 0)
   304                              <1> %macro Descriptor 3
   305                              <1> 	dw	%2 & 0FFFFh				             ; æ®µç•Œé™ 1				(2 å­—èŠ‚)
   306                              <1> 	dw	%1 & 0FFFFh				             ; æ®µåŸºå€ 1				(2 å­—èŠ‚)
   307                              <1> 	db	(%1 >> 16) & 0FFh			         ; æ®µåŸºå€ 2				(1 å­—èŠ‚)
   308                              <1> 	dw	((%2 >> 8) & 0F00h) | (%3 & 0F0FFh)	 ; å±æ€§ 1 + æ®µç•Œé™ 2 + å±æ€§ 2		(2 å­—èŠ‚)
   309                              <1> 	db	(%1 >> 24) & 0FFh			         ; æ®µåŸºå€ 3				(1 å­—èŠ‚)
   310                              <1> %endmacro ; å…± 8 å­—èŠ‚
   311                              <1> ;
   312                              <1> ; é—¨
   313                              <1> ; usage: Gate Selector, Offset, DCount, Attr
   314                              <1> ;        Selector:  dw
   315                              <1> ;        Offset:    dd
   316                              <1> ;        DCount:    db
   317                              <1> ;        Attr:      db
   318                              <1> %macro Gate 4
   319                              <1> 	dw	(%2 & 0FFFFh)				             ; åç§» 1				(2 å­—èŠ‚)
   320                              <1> 	dw	%1					                     ; é€‰æ‹©å­				(2 å­—èŠ‚)
   321                              <1> 	dw	(%3 & 1Fh) | ((%4 << 8) & 0FF00h)	     ; å±æ€§					(2 å­—èŠ‚)
   322                              <1> 	dw	((%2 >> 16) & 0FFFFh)			         ; åç§» 2				(2 å­—èŠ‚)
   323                              <1> %endmacro ; å…± 8 å­—èŠ‚
   324                              <1> ; ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   325                                  
   326                                  %define INIT_ADDR 0x7E00
   327                                  
   328                                  %define COLOR_GREEN 0x02 ;  Green
   329                                  %define COLOR_Cyan  0x03 ;  Cyan
   330                                  %define COLOR_RED   0x04 ;  red
   331                                  %define COLOR_White 0x0F ;  White
   332                                  
   333                                  %define ROWS 80
   334                                  %define ROWZ 2*ROWS
   335                                  %define COLUMNS 25
   336                                  
   337                                  
   338                                  [BITS 32]
   339                                  
   340                                  [SECTION .text]
   341                                      extern c_start             ;out
   342                                      extern print_a
   343                                      extern print_string_with_color  ;  void print_string_with_color(unsigned char * string, unsigned char color);
   344                                      extern init8259a
   345                                      extern start_clock
   346                                      extern start_multitasks
   347                                      extern task0
   348                                  
   349                                      global kernel_entry     ;entry
   350                                      global display_x    ;define vari
   351                                      global display_y    ;define vari
   352                                  
   353                                      kernel_entry:
   354                                          ;register initia
   355 00000000 B810000000                      mov eax,  0x10   
   356 00000005 8ED8                            mov ds,   ax     
   357 00000007 8EC0                            mov es,   ax    
   358 00000009 8EE0                            mov fs ,  ax 
   359 0000000B 8ED0                            mov ss,   ax    
   360 0000000D B818000000                      mov eax,  0x18  
   361 00000012 8EE8                            mov gs,   ax       
   362 00000014 BC00000A00                      mov esp,  0xA0000   
   363                                  
   364                                      reload_gdt:
   365 00000019 0F0115[96050000]                lgdt  [GdtPtr]
   366 00000020 EA[27000000]0800                jmp SelectorFlatC:haha
   367                                      haha:
   368                                          ;call print_a
   369                                  
   370                                  ;        void print_string_with_color(unsigned char * string, unsigned char color);
   371                                          ;push COLOR_RED
   372                                          ;push string1
   373                                          ;call print_string_with_color
   374                                          ;add esp, 0x08
   375                                  
   376                                      init_idt:
   377                                          ;prepare for load idt pointer
   378                                          ;xor eax,eax
   379                                          ;mov ax,ds
   380                                          ;shl eax,4
   381                                          ;add eax,idt;idt base address
   382                                          ;mov dword [idtPtr+2],eax;init base address
   383                                          ;close interrupt
   384 00000027 FA                              cli
   385                                          ;load idt pointer
   386 00000028 0F011D[08050000]                lidt [idtPtr]
   387                                      ;init idt OKkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk
   388                                  
   389 0000002F E8(00000000)                    call init8259a
   390                                          ;call start_clock
   391 00000034 CD20                            int 0x20;clock
   392 00000036 CD80                            int 0x80;user
   393 00000038 CD1F                            int 0x1f;all
   394 0000003A CD00                            int 0x00;test 0
   395                                  
   396                                          ;call c_start
   397                                  ;processsssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss
   398                                      ; Load LDT
   399 0000003C 66B83000                        mov ax, SelectorLDT
   400 00000040 0F00D0                          lldt    ax
   401 00000043 66B82000                        mov ax, SelectorTSS
   402 00000047 0F00D8                          ltr ax
   403                                      ;call start_process
   404 0000004A EA000000002800                  jmp SelectorTSS1:0
   405                                          ;jmp SelectorLDTP0:TASK0ADDRESS
   406                                          ;push    SelectorStack3
   407                                          ;push    TopOfStack3
   408                                          ;push    SelectorCodeRing3
   409                                          ;push    0
   410                                          ;retf
   411                                  
   412                                  ;processsssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss
   413 00000051 F4                              hlt
   414                                      here:		
   415 00000052 EBFE                            jmp here
   416                                  
   417 00000054 00000000                    display_x: dd 0
   418 00000058 00000000                    display_y: dd 0
   419                                  
   420 0000005C 616C6C20696E746572-         string0: db "all interrupts handler!",0x0a,0x00
   421 00000065 72757074732068616E-
   422 0000006E 646C6572210A00     
   423 00000075 636C6F636B20696E74-         string1: db "clock interrupt!",0x0a,0x00
   424 0000007E 657272757074210A00 
   425 00000087 6E6F7720697320696E-         string2: db "now is in normal",0x0a,0x00
   426 00000090 206E6F726D616C0A00 
   427 00000099 6E6F77206973207573-         string3: db "now is user interrupt",0x0a,0x00
   428 000000A2 657220696E74657272-
   429 000000AB 7570740A00         
   430 000000B0 5441534B3030303030-         string4: db "TASK00000000000000",0x0a,0x00
   431 000000B9 303030303030303030-
   432 000000C2 0A00               
   433 000000C4 696474203020746573-         string5: db "idt 0 test0Handler!!",0x0a,0x00
   434 000000CD 743048616E646C6572-
   435 000000D6 21210A00           
   436 000000DA 6A6D702053656C6563-         string6: db "jmp SelectorTSS:0 but jmp to int20h!",0x0a,0x00
   437 000000E3 746F725453533A3020-
   438 000000EC 627574206A6D702074-
   439 000000F5 6F20696E7432306821-
   440 000000FE 0A00               
   441                                      ;string1_addr equ string1-$$+INIT_ADDR
   442                                  
   443                                  ; idt gate
   444                                  ;iiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii
   445                                  ALIGN 32
   446                                      idt:
   447                                          ;é—¨    ç›®æ ‡é€‰æ‹©å­ åç§»        DCount   å±æ€§
   448                                    int00h:Gate   0x08,      test1Handler, 0,       DA_386IGate
   449                              <1>  int00h:
   450 00000100 4E83                <1>  dw (%2 & 0FFFFh)
   451 00000102 0800                <1>  dw %1
   452 00000104 008E                <1>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   453 00000106 0000                <1>  dw ((%2 >> 16) & 0FFFFh)
   454                                      %rep 30;   60h=0x40
   455                                          Gate   0x08,      test1Handler, 0,       DA_386IGate
   456                                      %endrep
   457                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   458 00000108 4E83                <2>  dw (%2 & 0FFFFh)
   459 0000010A 0800                <2>  dw %1
   460 0000010C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   461 0000010E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   462                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   463 00000110 4E83                <2>  dw (%2 & 0FFFFh)
   464 00000112 0800                <2>  dw %1
   465 00000114 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   466 00000116 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   467                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   468 00000118 4E83                <2>  dw (%2 & 0FFFFh)
   469 0000011A 0800                <2>  dw %1
   470 0000011C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   471 0000011E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   472                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   473 00000120 4E83                <2>  dw (%2 & 0FFFFh)
   474 00000122 0800                <2>  dw %1
   475 00000124 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   476 00000126 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   477                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   478 00000128 4E83                <2>  dw (%2 & 0FFFFh)
   479 0000012A 0800                <2>  dw %1
   480 0000012C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   481 0000012E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   482                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   483 00000130 4E83                <2>  dw (%2 & 0FFFFh)
   484 00000132 0800                <2>  dw %1
   485 00000134 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   486 00000136 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   487                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   488 00000138 4E83                <2>  dw (%2 & 0FFFFh)
   489 0000013A 0800                <2>  dw %1
   490 0000013C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   491 0000013E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   492                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   493 00000140 4E83                <2>  dw (%2 & 0FFFFh)
   494 00000142 0800                <2>  dw %1
   495 00000144 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   496 00000146 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   497                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   498 00000148 4E83                <2>  dw (%2 & 0FFFFh)
   499 0000014A 0800                <2>  dw %1
   500 0000014C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   501 0000014E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   502                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   503 00000150 4E83                <2>  dw (%2 & 0FFFFh)
   504 00000152 0800                <2>  dw %1
   505 00000154 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   506 00000156 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   507                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   508 00000158 4E83                <2>  dw (%2 & 0FFFFh)
   509 0000015A 0800                <2>  dw %1
   510 0000015C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   511 0000015E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   512                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   513 00000160 4E83                <2>  dw (%2 & 0FFFFh)
   514 00000162 0800                <2>  dw %1
   515 00000164 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   516 00000166 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   517                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   518 00000168 4E83                <2>  dw (%2 & 0FFFFh)
   519 0000016A 0800                <2>  dw %1
   520 0000016C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   521 0000016E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   522                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   523 00000170 4E83                <2>  dw (%2 & 0FFFFh)
   524 00000172 0800                <2>  dw %1
   525 00000174 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   526 00000176 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   527                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   528 00000178 4E83                <2>  dw (%2 & 0FFFFh)
   529 0000017A 0800                <2>  dw %1
   530 0000017C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   531 0000017E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   532                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   533 00000180 4E83                <2>  dw (%2 & 0FFFFh)
   534 00000182 0800                <2>  dw %1
   535 00000184 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   536 00000186 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   537                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   538 00000188 4E83                <2>  dw (%2 & 0FFFFh)
   539 0000018A 0800                <2>  dw %1
   540 0000018C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   541 0000018E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   542                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   543 00000190 4E83                <2>  dw (%2 & 0FFFFh)
   544 00000192 0800                <2>  dw %1
   545 00000194 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   546 00000196 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   547                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   548 00000198 4E83                <2>  dw (%2 & 0FFFFh)
   549 0000019A 0800                <2>  dw %1
   550 0000019C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   551 0000019E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   552                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   553 000001A0 4E83                <2>  dw (%2 & 0FFFFh)
   554 000001A2 0800                <2>  dw %1
   555 000001A4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   556 000001A6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   557                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   558 000001A8 4E83                <2>  dw (%2 & 0FFFFh)
   559 000001AA 0800                <2>  dw %1
   560 000001AC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   561 000001AE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   562                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   563 000001B0 4E83                <2>  dw (%2 & 0FFFFh)
   564 000001B2 0800                <2>  dw %1
   565 000001B4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   566 000001B6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   567                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   568 000001B8 4E83                <2>  dw (%2 & 0FFFFh)
   569 000001BA 0800                <2>  dw %1
   570 000001BC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   571 000001BE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   572                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   573 000001C0 4E83                <2>  dw (%2 & 0FFFFh)
   574 000001C2 0800                <2>  dw %1
   575 000001C4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   576 000001C6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   577                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   578 000001C8 4E83                <2>  dw (%2 & 0FFFFh)
   579 000001CA 0800                <2>  dw %1
   580 000001CC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   581 000001CE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   582                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   583 000001D0 4E83                <2>  dw (%2 & 0FFFFh)
   584 000001D2 0800                <2>  dw %1
   585 000001D4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   586 000001D6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   587                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   588 000001D8 4E83                <2>  dw (%2 & 0FFFFh)
   589 000001DA 0800                <2>  dw %1
   590 000001DC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   591 000001DE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   592                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   593 000001E0 4E83                <2>  dw (%2 & 0FFFFh)
   594 000001E2 0800                <2>  dw %1
   595 000001E4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   596 000001E6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   597                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   598 000001E8 4E83                <2>  dw (%2 & 0FFFFh)
   599 000001EA 0800                <2>  dw %1
   600 000001EC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   601 000001EE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   602                              <1>  Gate 0x08, test1Handler, 0, DA_386IGate
   603 000001F0 4E83                <2>  dw (%2 & 0FFFFh)
   604 000001F2 0800                <2>  dw %1
   605 000001F4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   606 000001F6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   607                                   int1fh:Gate   0x08,      test1Handler, 0,       DA_386IGate
   608                              <1>  int1fh:
   609 000001F8 4E83                <1>  dw (%2 & 0FFFFh)
   610 000001FA 0800                <1>  dw %1
   611 000001FC 008E                <1>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   612 000001FE 0000                <1>  dw ((%2 >> 16) & 0FFFFh)
   613                                   int20h:Gate   0x08,      clockHandler, 0,       DA_386IGate
   614                              <1>  int20h:
   615 00000200 1E83                <1>  dw (%2 & 0FFFFh)
   616 00000202 0800                <1>  dw %1
   617 00000204 008E                <1>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   618 00000206 0000                <1>  dw ((%2 >> 16) & 0FFFFh)
   619                                      %rep 95; =0x60-1
   620                                         Gate   0x08,      idtHandler, 0,       DA_386IGate
   621                                      %endrep
   622                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   623 00000208 0E83                <2>  dw (%2 & 0FFFFh)
   624 0000020A 0800                <2>  dw %1
   625 0000020C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   626 0000020E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   627                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   628 00000210 0E83                <2>  dw (%2 & 0FFFFh)
   629 00000212 0800                <2>  dw %1
   630 00000214 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   631 00000216 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   632                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   633 00000218 0E83                <2>  dw (%2 & 0FFFFh)
   634 0000021A 0800                <2>  dw %1
   635 0000021C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   636 0000021E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   637                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   638 00000220 0E83                <2>  dw (%2 & 0FFFFh)
   639 00000222 0800                <2>  dw %1
   640 00000224 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   641 00000226 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   642                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   643 00000228 0E83                <2>  dw (%2 & 0FFFFh)
   644 0000022A 0800                <2>  dw %1
   645 0000022C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   646 0000022E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   647                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   648 00000230 0E83                <2>  dw (%2 & 0FFFFh)
   649 00000232 0800                <2>  dw %1
   650 00000234 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   651 00000236 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   652                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   653 00000238 0E83                <2>  dw (%2 & 0FFFFh)
   654 0000023A 0800                <2>  dw %1
   655 0000023C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   656 0000023E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   657                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   658 00000240 0E83                <2>  dw (%2 & 0FFFFh)
   659 00000242 0800                <2>  dw %1
   660 00000244 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   661 00000246 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   662                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   663 00000248 0E83                <2>  dw (%2 & 0FFFFh)
   664 0000024A 0800                <2>  dw %1
   665 0000024C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   666 0000024E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   667                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   668 00000250 0E83                <2>  dw (%2 & 0FFFFh)
   669 00000252 0800                <2>  dw %1
   670 00000254 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   671 00000256 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   672                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   673 00000258 0E83                <2>  dw (%2 & 0FFFFh)
   674 0000025A 0800                <2>  dw %1
   675 0000025C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   676 0000025E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   677                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   678 00000260 0E83                <2>  dw (%2 & 0FFFFh)
   679 00000262 0800                <2>  dw %1
   680 00000264 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   681 00000266 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   682                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   683 00000268 0E83                <2>  dw (%2 & 0FFFFh)
   684 0000026A 0800                <2>  dw %1
   685 0000026C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   686 0000026E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   687                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   688 00000270 0E83                <2>  dw (%2 & 0FFFFh)
   689 00000272 0800                <2>  dw %1
   690 00000274 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   691 00000276 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   692                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   693 00000278 0E83                <2>  dw (%2 & 0FFFFh)
   694 0000027A 0800                <2>  dw %1
   695 0000027C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   696 0000027E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   697                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   698 00000280 0E83                <2>  dw (%2 & 0FFFFh)
   699 00000282 0800                <2>  dw %1
   700 00000284 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   701 00000286 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   702                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   703 00000288 0E83                <2>  dw (%2 & 0FFFFh)
   704 0000028A 0800                <2>  dw %1
   705 0000028C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   706 0000028E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   707                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   708 00000290 0E83                <2>  dw (%2 & 0FFFFh)
   709 00000292 0800                <2>  dw %1
   710 00000294 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   711 00000296 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   712                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   713 00000298 0E83                <2>  dw (%2 & 0FFFFh)
   714 0000029A 0800                <2>  dw %1
   715 0000029C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   716 0000029E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   717                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   718 000002A0 0E83                <2>  dw (%2 & 0FFFFh)
   719 000002A2 0800                <2>  dw %1
   720 000002A4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   721 000002A6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   722                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   723 000002A8 0E83                <2>  dw (%2 & 0FFFFh)
   724 000002AA 0800                <2>  dw %1
   725 000002AC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   726 000002AE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   727                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   728 000002B0 0E83                <2>  dw (%2 & 0FFFFh)
   729 000002B2 0800                <2>  dw %1
   730 000002B4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   731 000002B6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   732                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   733 000002B8 0E83                <2>  dw (%2 & 0FFFFh)
   734 000002BA 0800                <2>  dw %1
   735 000002BC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   736 000002BE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   737                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   738 000002C0 0E83                <2>  dw (%2 & 0FFFFh)
   739 000002C2 0800                <2>  dw %1
   740 000002C4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   741 000002C6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   742                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   743 000002C8 0E83                <2>  dw (%2 & 0FFFFh)
   744 000002CA 0800                <2>  dw %1
   745 000002CC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   746 000002CE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   747                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   748 000002D0 0E83                <2>  dw (%2 & 0FFFFh)
   749 000002D2 0800                <2>  dw %1
   750 000002D4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   751 000002D6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   752                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   753 000002D8 0E83                <2>  dw (%2 & 0FFFFh)
   754 000002DA 0800                <2>  dw %1
   755 000002DC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   756 000002DE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   757                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   758 000002E0 0E83                <2>  dw (%2 & 0FFFFh)
   759 000002E2 0800                <2>  dw %1
   760 000002E4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   761 000002E6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   762                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   763 000002E8 0E83                <2>  dw (%2 & 0FFFFh)
   764 000002EA 0800                <2>  dw %1
   765 000002EC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   766 000002EE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   767                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   768 000002F0 0E83                <2>  dw (%2 & 0FFFFh)
   769 000002F2 0800                <2>  dw %1
   770 000002F4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   771 000002F6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   772                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   773 000002F8 0E83                <2>  dw (%2 & 0FFFFh)
   774 000002FA 0800                <2>  dw %1
   775 000002FC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   776 000002FE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   777                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   778 00000300 0E83                <2>  dw (%2 & 0FFFFh)
   779 00000302 0800                <2>  dw %1
   780 00000304 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   781 00000306 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   782                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   783 00000308 0E83                <2>  dw (%2 & 0FFFFh)
   784 0000030A 0800                <2>  dw %1
   785 0000030C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   786 0000030E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   787                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   788 00000310 0E83                <2>  dw (%2 & 0FFFFh)
   789 00000312 0800                <2>  dw %1
   790 00000314 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   791 00000316 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   792                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   793 00000318 0E83                <2>  dw (%2 & 0FFFFh)
   794 0000031A 0800                <2>  dw %1
   795 0000031C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   796 0000031E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   797                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   798 00000320 0E83                <2>  dw (%2 & 0FFFFh)
   799 00000322 0800                <2>  dw %1
   800 00000324 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   801 00000326 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   802                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   803 00000328 0E83                <2>  dw (%2 & 0FFFFh)
   804 0000032A 0800                <2>  dw %1
   805 0000032C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   806 0000032E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   807                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   808 00000330 0E83                <2>  dw (%2 & 0FFFFh)
   809 00000332 0800                <2>  dw %1
   810 00000334 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   811 00000336 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   812                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   813 00000338 0E83                <2>  dw (%2 & 0FFFFh)
   814 0000033A 0800                <2>  dw %1
   815 0000033C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   816 0000033E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   817                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   818 00000340 0E83                <2>  dw (%2 & 0FFFFh)
   819 00000342 0800                <2>  dw %1
   820 00000344 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   821 00000346 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   822                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   823 00000348 0E83                <2>  dw (%2 & 0FFFFh)
   824 0000034A 0800                <2>  dw %1
   825 0000034C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   826 0000034E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   827                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   828 00000350 0E83                <2>  dw (%2 & 0FFFFh)
   829 00000352 0800                <2>  dw %1
   830 00000354 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   831 00000356 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   832                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   833 00000358 0E83                <2>  dw (%2 & 0FFFFh)
   834 0000035A 0800                <2>  dw %1
   835 0000035C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   836 0000035E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   837                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   838 00000360 0E83                <2>  dw (%2 & 0FFFFh)
   839 00000362 0800                <2>  dw %1
   840 00000364 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   841 00000366 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   842                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   843 00000368 0E83                <2>  dw (%2 & 0FFFFh)
   844 0000036A 0800                <2>  dw %1
   845 0000036C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   846 0000036E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   847                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   848 00000370 0E83                <2>  dw (%2 & 0FFFFh)
   849 00000372 0800                <2>  dw %1
   850 00000374 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   851 00000376 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   852                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   853 00000378 0E83                <2>  dw (%2 & 0FFFFh)
   854 0000037A 0800                <2>  dw %1
   855 0000037C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   856 0000037E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   857                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   858 00000380 0E83                <2>  dw (%2 & 0FFFFh)
   859 00000382 0800                <2>  dw %1
   860 00000384 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   861 00000386 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   862                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   863 00000388 0E83                <2>  dw (%2 & 0FFFFh)
   864 0000038A 0800                <2>  dw %1
   865 0000038C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   866 0000038E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   867                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   868 00000390 0E83                <2>  dw (%2 & 0FFFFh)
   869 00000392 0800                <2>  dw %1
   870 00000394 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   871 00000396 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   872                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   873 00000398 0E83                <2>  dw (%2 & 0FFFFh)
   874 0000039A 0800                <2>  dw %1
   875 0000039C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   876 0000039E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   877                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   878 000003A0 0E83                <2>  dw (%2 & 0FFFFh)
   879 000003A2 0800                <2>  dw %1
   880 000003A4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   881 000003A6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   882                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   883 000003A8 0E83                <2>  dw (%2 & 0FFFFh)
   884 000003AA 0800                <2>  dw %1
   885 000003AC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   886 000003AE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   887                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   888 000003B0 0E83                <2>  dw (%2 & 0FFFFh)
   889 000003B2 0800                <2>  dw %1
   890 000003B4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   891 000003B6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   892                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   893 000003B8 0E83                <2>  dw (%2 & 0FFFFh)
   894 000003BA 0800                <2>  dw %1
   895 000003BC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   896 000003BE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   897                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   898 000003C0 0E83                <2>  dw (%2 & 0FFFFh)
   899 000003C2 0800                <2>  dw %1
   900 000003C4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   901 000003C6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   902                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   903 000003C8 0E83                <2>  dw (%2 & 0FFFFh)
   904 000003CA 0800                <2>  dw %1
   905 000003CC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   906 000003CE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   907                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   908 000003D0 0E83                <2>  dw (%2 & 0FFFFh)
   909 000003D2 0800                <2>  dw %1
   910 000003D4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   911 000003D6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   912                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   913 000003D8 0E83                <2>  dw (%2 & 0FFFFh)
   914 000003DA 0800                <2>  dw %1
   915 000003DC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   916 000003DE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   917                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   918 000003E0 0E83                <2>  dw (%2 & 0FFFFh)
   919 000003E2 0800                <2>  dw %1
   920 000003E4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   921 000003E6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   922                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   923 000003E8 0E83                <2>  dw (%2 & 0FFFFh)
   924 000003EA 0800                <2>  dw %1
   925 000003EC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   926 000003EE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   927                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   928 000003F0 0E83                <2>  dw (%2 & 0FFFFh)
   929 000003F2 0800                <2>  dw %1
   930 000003F4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   931 000003F6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   932                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   933 000003F8 0E83                <2>  dw (%2 & 0FFFFh)
   934 000003FA 0800                <2>  dw %1
   935 000003FC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   936 000003FE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   937                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   938 00000400 0E83                <2>  dw (%2 & 0FFFFh)
   939 00000402 0800                <2>  dw %1
   940 00000404 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   941 00000406 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   942                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   943 00000408 0E83                <2>  dw (%2 & 0FFFFh)
   944 0000040A 0800                <2>  dw %1
   945 0000040C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   946 0000040E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   947                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   948 00000410 0E83                <2>  dw (%2 & 0FFFFh)
   949 00000412 0800                <2>  dw %1
   950 00000414 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   951 00000416 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   952                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   953 00000418 0E83                <2>  dw (%2 & 0FFFFh)
   954 0000041A 0800                <2>  dw %1
   955 0000041C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   956 0000041E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   957                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   958 00000420 0E83                <2>  dw (%2 & 0FFFFh)
   959 00000422 0800                <2>  dw %1
   960 00000424 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   961 00000426 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   962                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   963 00000428 0E83                <2>  dw (%2 & 0FFFFh)
   964 0000042A 0800                <2>  dw %1
   965 0000042C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   966 0000042E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   967                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   968 00000430 0E83                <2>  dw (%2 & 0FFFFh)
   969 00000432 0800                <2>  dw %1
   970 00000434 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   971 00000436 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   972                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   973 00000438 0E83                <2>  dw (%2 & 0FFFFh)
   974 0000043A 0800                <2>  dw %1
   975 0000043C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   976 0000043E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   977                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   978 00000440 0E83                <2>  dw (%2 & 0FFFFh)
   979 00000442 0800                <2>  dw %1
   980 00000444 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   981 00000446 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   982                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   983 00000448 0E83                <2>  dw (%2 & 0FFFFh)
   984 0000044A 0800                <2>  dw %1
   985 0000044C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   986 0000044E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   987                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   988 00000450 0E83                <2>  dw (%2 & 0FFFFh)
   989 00000452 0800                <2>  dw %1
   990 00000454 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   991 00000456 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   992                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   993 00000458 0E83                <2>  dw (%2 & 0FFFFh)
   994 0000045A 0800                <2>  dw %1
   995 0000045C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
   996 0000045E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
   997                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
   998 00000460 0E83                <2>  dw (%2 & 0FFFFh)
   999 00000462 0800                <2>  dw %1
  1000 00000464 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1001 00000466 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1002                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1003 00000468 0E83                <2>  dw (%2 & 0FFFFh)
  1004 0000046A 0800                <2>  dw %1
  1005 0000046C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1006 0000046E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1007                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1008 00000470 0E83                <2>  dw (%2 & 0FFFFh)
  1009 00000472 0800                <2>  dw %1
  1010 00000474 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1011 00000476 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1012                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1013 00000478 0E83                <2>  dw (%2 & 0FFFFh)
  1014 0000047A 0800                <2>  dw %1
  1015 0000047C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1016 0000047E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1017                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1018 00000480 0E83                <2>  dw (%2 & 0FFFFh)
  1019 00000482 0800                <2>  dw %1
  1020 00000484 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1021 00000486 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1022                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1023 00000488 0E83                <2>  dw (%2 & 0FFFFh)
  1024 0000048A 0800                <2>  dw %1
  1025 0000048C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1026 0000048E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1027                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1028 00000490 0E83                <2>  dw (%2 & 0FFFFh)
  1029 00000492 0800                <2>  dw %1
  1030 00000494 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1031 00000496 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1032                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1033 00000498 0E83                <2>  dw (%2 & 0FFFFh)
  1034 0000049A 0800                <2>  dw %1
  1035 0000049C 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1036 0000049E 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1037                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1038 000004A0 0E83                <2>  dw (%2 & 0FFFFh)
  1039 000004A2 0800                <2>  dw %1
  1040 000004A4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1041 000004A6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1042                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1043 000004A8 0E83                <2>  dw (%2 & 0FFFFh)
  1044 000004AA 0800                <2>  dw %1
  1045 000004AC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1046 000004AE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1047                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1048 000004B0 0E83                <2>  dw (%2 & 0FFFFh)
  1049 000004B2 0800                <2>  dw %1
  1050 000004B4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1051 000004B6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1052                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1053 000004B8 0E83                <2>  dw (%2 & 0FFFFh)
  1054 000004BA 0800                <2>  dw %1
  1055 000004BC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1056 000004BE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1057                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1058 000004C0 0E83                <2>  dw (%2 & 0FFFFh)
  1059 000004C2 0800                <2>  dw %1
  1060 000004C4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1061 000004C6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1062                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1063 000004C8 0E83                <2>  dw (%2 & 0FFFFh)
  1064 000004CA 0800                <2>  dw %1
  1065 000004CC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1066 000004CE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1067                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1068 000004D0 0E83                <2>  dw (%2 & 0FFFFh)
  1069 000004D2 0800                <2>  dw %1
  1070 000004D4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1071 000004D6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1072                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1073 000004D8 0E83                <2>  dw (%2 & 0FFFFh)
  1074 000004DA 0800                <2>  dw %1
  1075 000004DC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1076 000004DE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1077                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1078 000004E0 0E83                <2>  dw (%2 & 0FFFFh)
  1079 000004E2 0800                <2>  dw %1
  1080 000004E4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1081 000004E6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1082                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1083 000004E8 0E83                <2>  dw (%2 & 0FFFFh)
  1084 000004EA 0800                <2>  dw %1
  1085 000004EC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1086 000004EE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1087                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1088 000004F0 0E83                <2>  dw (%2 & 0FFFFh)
  1089 000004F2 0800                <2>  dw %1
  1090 000004F4 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1091 000004F6 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1092                              <1>  Gate 0x08, idtHandler, 0, DA_386IGate
  1093 000004F8 0E83                <2>  dw (%2 & 0FFFFh)
  1094 000004FA 0800                <2>  dw %1
  1095 000004FC 008E                <2>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1096 000004FE 0000                <2>  dw ((%2 >> 16) & 0FFFFh)
  1097                                  int80h: Gate   0x08,      userHandler, 0,       DA_386IGate
  1098                              <1> int80h: 
  1099 00000500 2E83                <1>  dw (%2 & 0FFFFh)
  1100 00000502 0800                <1>  dw %1
  1101 00000504 008E                <1>  dw (%3 & 1Fh) | ((%4 << 8) & 0FF00h)
  1102 00000506 0000                <1>  dw ((%2 >> 16) & 0FFFFh)
  1103                                  
  1104                                      idtLen  equ  $-idt
  1105 00000508 0704                        idtPtr  dw   idtLen-1;æ®µç•Œé™
  1106 0000050A [00010000]                          dd   idt; base address
  1107                                  ;iiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii
  1108                                  
  1109                                  ; idt handler
  1110                                  ;>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
  1111                                      _idtHandler:
  1112                                      idtHandler equ  _idtHandler - $$ + INIT_ADDR
  1113                                          ;  void print_string_with_color(unsigned char * string, unsigned char color);
  1114 0000050E 6A0F                            push COLOR_White
  1115 00000510 68[5C000000]                    push string0
  1116 00000515 E8(00000000)                    call print_string_with_color
  1117 0000051A 83C408                          add esp, 0x08
  1118                                  
  1119 0000051D CF                              iretd
  1120                                  
  1121                                      _clockHandler:
  1122                                      clockHandler equ  _clockHandler - $$ + INIT_ADDR
  1123                                          ;  void print_string_with_color(unsigned char * string, unsigned char color);
  1124 0000051E 6A04                            push COLOR_RED
  1125 00000520 68[75000000]                    push string1
  1126 00000525 E8(00000000)                    call print_string_with_color
  1127 0000052A 83C408                          add esp, 0x08
  1128                                  
  1129 0000052D CF                              iretd
  1130                                  
  1131                                      _userHandler:
  1132                                      userHandler equ  _userHandler - $$ + INIT_ADDR
  1133                                          ;  void print_string_with_color(unsigned char * string, unsigned char color);
  1134 0000052E 6A02                            push COLOR_GREEN
  1135 00000530 68[99000000]                    push string3
  1136 00000535 E8(00000000)                    call print_string_with_color
  1137 0000053A 83C408                          add esp, 0x08
  1138                                  
  1139 0000053D CF                              iretd
  1140                                      _test0Handler:
  1141                                      test0Handler equ  _test0Handler - $$ + INIT_ADDR
  1142                                          ;  void print_string_with_color(unsigned char * string, unsigned char color);
  1143 0000053E 6A03                            push COLOR_Cyan
  1144 00000540 68[DA000000]                    push string6
  1145 00000545 E8(00000000)                    call print_string_with_color
  1146 0000054A 83C408                          add esp, 0x08
  1147                                  
  1148 0000054D CF                              iretd
  1149                                      _test1Handler:
  1150                                      test1Handler equ  _test1Handler - $$ + INIT_ADDR
  1151                                          ;  void print_string_with_color(unsigned char * string, unsigned char color);
  1152 0000054E 6A03                            push COLOR_Cyan
  1153 00000550 68[C4000000]                    push string5
  1154 00000555 E8(00000000)                    call print_string_with_color
  1155 0000055A 83C408                          add esp, 0x08
  1156                                  
  1157 0000055D CF                              iretd
  1158                                  ;<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<   
  1159                                  
  1160                                  ; new GDT ----------------------------------------------------------------------------------------
  1161                                  ;                         æ®µåŸºå€,      æ®µç•Œé™,   å±æ€§                                 -
  1162                                  GDT:       Descriptor          0,           0,   0                             ; ç©ºæè¿°ç¬¦   -
  1163                              <1> GDT: 
  1164 0000055E 0000                <1>  dw %2 & 0FFFFh
  1165 00000560 0000                <1>  dw %1 & 0FFFFh
  1166 00000562 00                  <1>  db (%1 >> 16) & 0FFh
  1167 00000563 0000                <1>  dw ((%2 >> 8) & 0F00h) | (%3 & 0F0FFh)
  1168 00000565 00                  <1>  db (%1 >> 24) & 0FFh
  1169                                  FLAT_C:    Descriptor          0,     0fffffh,   DA_CR  | DA_32 | DA_LIMIT_4K ;|DA_DRW ; 0 ~ 4G     -
  1170                              <1> FLAT_C: 
  1171 00000566 FFFF                <1>  dw %2 & 0FFFFh
  1172 00000568 0000                <1>  dw %1 & 0FFFFh
  1173 0000056A 00                  <1>  db (%1 >> 16) & 0FFh
  1174 0000056B 9ACF                <1>  dw ((%2 >> 8) & 0F00h) | (%3 & 0F0FFh)
  1175 0000056D 00                  <1>  db (%1 >> 24) & 0FFh
  1176                                  FLAT_RW:   Descriptor          0,     0fffffh,   DA_DRW | DA_32 | DA_LIMIT_4K  ; 0 ~ 4G     -
  1177                              <1> FLAT_RW: 
  1178 0000056E FFFF                <1>  dw %2 & 0FFFFh
  1179 00000570 0000                <1>  dw %1 & 0FFFFh
  1180 00000572 00                  <1>  db (%1 >> 16) & 0FFh
  1181 00000573 92CF                <1>  dw ((%2 >> 8) & 0F00h) | (%3 & 0F0FFh)
  1182 00000575 00                  <1>  db (%1 >> 24) & 0FFh
  1183                                  VIDEO:     Descriptor    0B8000h,      0ffffh,   DA_DRW ;| DA_DPL3              ; æ˜¾å­˜é¦–åœ°å€ -
  1184                              <1> VIDEO: 
  1185 00000576 FFFF                <1>  dw %2 & 0FFFFh
  1186 00000578 0080                <1>  dw %1 & 0FFFFh
  1187 0000057A 0B                  <1>  db (%1 >> 16) & 0FFh
  1188 0000057B 9200                <1>  dw ((%2 >> 8) & 0F00h) | (%3 & 0F0FFh)
  1189 0000057D 00                  <1>  db (%1 >> 24) & 0FFh
  1190                                  DESC_TSS:  Descriptor TSSADDRESS,    TSSLen-1,   DA_386TSS
  1191                              <1> DESC_TSS: 
  1192 0000057E 6700                <1>  dw %2 & 0FFFFh
  1193 00000580 9C83                <1>  dw %1 & 0FFFFh
  1194 00000582 00                  <1>  db (%1 >> 16) & 0FFh
  1195 00000583 8900                <1>  dw ((%2 >> 8) & 0F00h) | (%3 & 0F0FFh)
  1196 00000585 00                  <1>  db (%1 >> 24) & 0FFh
  1197                                  DESC_TSS1: Descriptor TSS1ADDRESS,    TSS1Len-1,   DA_386TSS
  1198                              <1> DESC_TSS1: 
  1199 00000586 6700                <1>  dw %2 & 0FFFFh
  1200 00000588 0484                <1>  dw %1 & 0FFFFh
  1201 0000058A 00                  <1>  db (%1 >> 16) & 0FFh
  1202 0000058B 8900                <1>  dw ((%2 >> 8) & 0F00h) | (%3 & 0F0FFh)
  1203 0000058D 00                  <1>  db (%1 >> 24) & 0FFh
  1204                                  LDT_IN_GDT:Descriptor LDTADDRESS,    LDTLen-1,   DA_LDT    ; LDT
  1205                              <1> LDT_IN_GDT:
  1206 0000058E 0F00                <1>  dw %2 & 0FFFFh
  1207 00000590 6C84                <1>  dw %1 & 0FFFFh
  1208 00000592 00                  <1>  db (%1 >> 16) & 0FFh
  1209 00000593 8200                <1>  dw ((%2 >> 8) & 0F00h) | (%3 & 0F0FFh)
  1210 00000595 00                  <1>  db (%1 >> 24) & 0FFh
  1211                                  ; GDT END-------------------------------------------------------------------------------------
  1212                                  
  1213                                  GdtLen  equ $ - GDT
  1214 00000596 3700                    GdtPtr  dw GdtLen - 1                          ; æ®µç•Œé™
  1215 00000598 [5E050000]                      dd GDT;+ BaseOfLoaderPhyAddr           ; åŸºåœ°å€
  1216                                  
  1217                                  
  1218                                  ; GDT é€‰æ‹©å­ ---------------------------------------------
  1219                                  SelectorFlatC     equ   FLAT_C   - GDT              ;1*8
  1220                                  SelectorFlatRW    equ   FLAT_RW  - GDT              ;2*8
  1221                                  SelectorVideo     equ   VIDEO    - GDT ;+ SA_RPL3   ;3*8
  1222                                  SelectorTSS       equ  DESC_TSS  - GDT              ;4*8
  1223                                  SelectorTSS1      equ  DESC_TSS1 - GDT              ;5*8
  1224                                  SelectorLDT       equ LDT_IN_GDT - GDT              ;6*8
  1225                                  ; GDT é€‰æ‹©å­ end------------------------------------------
  1226                                  
  1227                                  [BITS   32]
  1228                                  TSS:
  1229                                  TSSADDRESS equ $-$$+INIT_ADDR
  1230 0000059C 0000                        DW  0           ; Previous Task Link
  1231 0000059E 0000                        DW  0           ; Reserved 
  1232 000005A0 00000000                    DD  0           ; ESP0
  1233 000005A4 0000                        DW  0           ; SS0
  1234 000005A6 0000                        DW  0           ; Reserved 
  1235 000005A8 00000000                    DD  0           ; ESP1
  1236 000005AC 0000                        DW  0           ; SS1
  1237 000005AE 0000                        DW  0           ; Reserved 
  1238 000005B0 00000000                    DD  0           ; ESP2
  1239 000005B4 0000                        DW  0           ; SS2
  1240 000005B6 0000                        DW  0           ; Reserved 
  1241 000005B8 00000000                    DD  0           ;CR3 (PDBR)
  1242 000005BC 00000000                    DD  0           ;EIP
  1243 000005C0 00000000                    DD  0           ;EFLAGS
  1244 000005C4 00000000                    DD  0           ;EAX
  1245 000005C8 00000000                    DD  0           ;ECX
  1246 000005CC 00000000                    DD  0           ;EDX
  1247 000005D0 00000000                    DD  0           ;EBX
  1248 000005D4 00000000                    DD  0           ;ESP
  1249 000005D8 00000000                    DD  0           ;EBP
  1250 000005DC 00000000                    DD  0           ;ESI
  1251 000005E0 00000000                    DD  0           ;EDI
  1252 000005E4 0000                        DW  0           ; ES
  1253 000005E6 0000                        DW  0           ; Reserved 
  1254 000005E8 0000                        DW  0           ; CS
  1255 000005EA 0000                        DW  0           ; Reserved 
  1256 000005EC 0000                        DW  0           ; SS
  1257 000005EE 0000                        DW  0           ; Reserved 
  1258 000005F0 0000                        DW  0           ; DS
  1259 000005F2 0000                        DW  0           ; Reserved 
  1260 000005F4 0000                        DW  0           ; FS
  1261 000005F6 0000                        DW  0           ; Reserved 
  1262 000005F8 0000                        DW  0           ; GS
  1263 000005FA 0000                        DW  0           ; Reserved 
  1264 000005FC 0000                        DW  0           ; LDT Segment Selector
  1265 000005FE 0000                        DW  0           ; Reserved 
  1266 00000600 0000                        DW  0           ; Reserved
  1267 00000602 0040                        DW  0x4000           ; I/O Map Base Address 
  1268                                      
  1269                                  TSSLen      equ $ - TSS     ;must have a value equal to or greater than 103
  1270                                  
  1271                                  TSS1:
  1272                                  TSS1ADDRESS equ $-$$+INIT_ADDR
  1273 00000604 0000                        DW  0           ; Previous Task Link
  1274 00000606 0000                        DW  0           ; Reserved 
  1275 00000608 00000000                    DD  0           ; ESP0
  1276 0000060C 0000                        DW  0           ; SS0
  1277 0000060E 0000                        DW  0           ; Reserved 
  1278 00000610 00000000                    DD  0           ; ESP1
  1279 00000614 0000                        DW  0           ; SS1
  1280 00000616 0000                        DW  0           ; Reserved 
  1281 00000618 00000000                    DD  0           ; ESP2
  1282 0000061C 0000                        DW  0           ; SS2
  1283 0000061E 0000                        DW  0           ; Reserved 
  1284 00000620 00000000                    DD  0           ;CR3 (PDBR)
  1285 00000624 7C840000                    DD  TASK0ADDRESS           ;EIP
  1286 00000628 00000000                    DD  0           ;EFLAGS
  1287 0000062C 00000000                    DD  0           ;EAX
  1288 00000630 00000000                    DD  0           ;ECX
  1289 00000634 00000000                    DD  0           ;EDX
  1290 00000638 00000000                    DD  0           ;EBX
  1291 0000063C 00000000                    DD  0           ;ESP
  1292 00000640 00000000                    DD  0           ;EBP
  1293 00000644 00000000                    DD  0           ;ESI
  1294 00000648 00000000                    DD  0           ;EDI
  1295 0000064C 1000                        DW  SelectorFlatRW           ; ES
  1296 0000064E 0000                        DW  0           ; Reserved 
  1297 00000650 0800                        DW  SelectorFlatC           ; CS
  1298 00000652 0000                        DW  0           ; Reserved 
  1299 00000654 1000                        DW  SelectorFlatRW           ; SS
  1300 00000656 0000                        DW  0           ; Reserved 
  1301 00000658 1000                        DW  SelectorFlatRW           ; DS
  1302 0000065A 0000                        DW  0           ; Reserved 
  1303 0000065C 1000                        DW  SelectorFlatRW           ; FS
  1304 0000065E 0000                        DW  0           ; Reserved 
  1305 00000660 1800                        DW  SelectorVideo           ; GS
  1306 00000662 0000                        DW  0           ; Reserved 
  1307 00000664 0000                        DW  0           ; LDT Segment Selector
  1308 00000666 0000                        DW  0           ; Reserved 
  1309 00000668 0000                        DW  0           ; Reserved
  1310 0000066A 0040                        DW  0x4000           ; I/O Map Base Address 
  1311                                      
  1312                                  TSS1Len      equ $ - TSS1     ;must have a value equal to or greater than 103
  1313                                  
  1314                                  ;ALIGN   32
  1315                                  LDT:
  1316                                  LDTADDRESS equ $-$$+INIT_ADDR
  1317                                  ;                            æ®µåŸºå€       æ®µç•Œé™      å±æ€§
  1318                                  LDT_P0: Descriptor TASK0ADDRESS, TASK0Len - 1, DA_C + DA_32 ; Code, 32 ä½
  1319                              <1> LDT_P0: 
  1320 0000066C 0C00                <1>  dw %2 & 0FFFFh
  1321 0000066E 7C84                <1>  dw %1 & 0FFFFh
  1322 00000670 00                  <1>  db (%1 >> 16) & 0FFh
  1323 00000671 9840                <1>  dw ((%2 >> 8) & 0F00h) | (%3 & 0F0FFh)
  1324 00000673 00                  <1>  db (%1 >> 24) & 0FFh
  1325                                  LDT_P0_RW: Descriptor TASK0_RWADDRESS, TASK0_RWLen - 1, DA_DRW  ; Code, 32 ä½
  1326                              <1> LDT_P0_RW: 
  1327 00000674 FF03                <1>  dw %2 & 0FFFFh
  1328 00000676 8984                <1>  dw %1 & 0FFFFh
  1329 00000678 00                  <1>  db (%1 >> 16) & 0FFh
  1330 00000679 9200                <1>  dw ((%2 >> 8) & 0F00h) | (%3 & 0F0FFh)
  1331 0000067B 00                  <1>  db (%1 >> 24) & 0FFh
  1332                                  ;LDT_P0: Descriptor 0,     0fffffh,   DA_CR  | DA_32 | DA_LIMIT_4K
  1333                                  
  1334                                  LDTLen      equ $ - LDT
  1335                                  ; LDT é€‰æ‹©å­
  1336                                  SelectorLDTP0    equ LDT_P0    - LDT + SA_TIL
  1337                                  SelectorLDTP0_RW    equ LDT_P0_RW    - LDT + SA_TIL
  1338                                  ; END of [SECTION .ldt]
  1339                                  
  1340                                  TASK0:
  1341                                  TASK0ADDRESS equ $-$$+INIT_ADDR
  1342                                      ;print_a:
  1343 0000067C B078                            mov al, 'x'    
  1344 0000067E B40F                            mov ah, 0x0f   ;åœŸçº¢è‰²
  1345 00000680 31FF                            xor edi, edi
  1346 00000682 65668907                        mov [gs:edi], ax        
  1347                                          ;ret
  1348                                  
  1349 00000686 F4                          hlt
  1350 00000687 EBFE                        jmp $
  1351                                  TASK0Len equ $ - TASK0
  1352                                  
  1353                                  TASK0_RW:
  1354                                  TASK0_RWADDRESS equ $-$$+INIT_ADDR
  1355 00000689 00<rept>                    times 1024 db 0
  1356                                  TASK0_RWLen equ $ - TASK0_RW
  1357                                  ; END 
